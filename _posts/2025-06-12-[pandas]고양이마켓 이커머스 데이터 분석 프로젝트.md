---

title: "[pandas]ê³ ì–‘ì´ë§ˆì¼“ ì´ì»¤ë¨¸ìŠ¤ ë°ì´í„° ë¶„ì„ í”„ë¡œì íŠ¸" 
date: 2025-06-12-01:52:00 +0900
categories: [data-analysis, pandas,e-commerce] 
tags: [pandas, python, ë°ì´í„°ë¶„ì„, ì‹œê°í™”, í†µê³„ë¶„ì„, ì´ì»¤ë¨¸ìŠ¤, jupyter]
description: ê³ ì–‘ì´ë§ˆì¼“ ì´ì»¤ë¨¸ìŠ¤ ë¶„ì„ í”„ë¡œì íŠ¸ì˜ ì „ì²´ ì½”ë“œ íë¦„ê³¼ ê° ë‹¨ê³„ë³„ ì„¤ëª…ì„ ë‹´ì€ ê¸°ìˆ  ë¸”ë¡œê·¸ìš© ì •ë¦¬ë³¸ì…ë‹ˆë‹¤.
pin: true

---


```python
import pandas as pd
import random
from datetime import datetime, timedelta
import numpy as np

# ê³ ê° ìˆ˜
NUM_CUSTOMERS = 10

# ê³ ê° í…Œì´ë¸” ìƒì„±
customers = pd.DataFrame({
    'customer_id': [f'CUST{str(i).zfill(3)}' for i in range(1, NUM_CUSTOMERS + 1)],
    'name': [f'ì§‘ì‚¬{i}' for i in range(1, NUM_CUSTOMERS + 1)],
    'ê°€ì…ì¼': [datetime(2024, random.randint(1, 12), random.randint(1, 28)) for _ in range(NUM_CUSTOMERS)],
    'ìƒë…„ì›”ì¼': [datetime(1980 + random.randint(0, 20), random.randint(1, 12), random.randint(1, 28)) for _ in range(NUM_CUSTOMERS)]
})
```

```python
# ê³ ì–‘ì´ ìˆ˜ = ê³ ê° ìˆ˜ * 1~2ë§ˆë¦¬ ëœë¤
cat_records = []
for idx, row in customers.iterrows():
    num_cats = random.randint(1, 2)
    for i in range(num_cats):
        cat_records.append({
            'cat_id': f'CAT{len(cat_records)+1:03d}',
            'customer_id': row['customer_id'],
            'name': f'ë‚˜ë¹„{len(cat_records)+1}',
            'ë‚˜ì´(ê°œì›”)': random.randint(6, 180),
            'ì„±ë³„': random.choice(['F', 'M']),
            'í’ˆì¢…': random.choice(['ì½”ìˆ', 'ëŸ¬ì‹œì•ˆë¸”ë£¨', 'ìŠ¤í•‘í¬ìŠ¤', 'ë¨¼ì¹˜í‚¨']),
            'ì§€ë³‘ ì´ë ¥': random.choice(['ìš”ë¡œê²°ì„', 'ë¹„ì—¼', 'ì—†ìŒ']),
            'cat_birthday': datetime(2025, random.randint(1, 12), random.randint(1, 28))
        })

cats = pd.DataFrame(cat_records)

```

```python
categories = ['ì‚¬ë£Œ', 'ê°„ì‹', 'ì¥ë‚œê°', 'ê±´ê°•', 'ìƒí™œìš©í’ˆ']
products = pd.DataFrame({
    'product_id': [f'PROD{str(i).zfill(3)}' for i in range(1, 11)],
    'name': [f'ìƒí’ˆ{i}' for i in range(1, 11)],
    'ì¹´í…Œê³ ë¦¬': random.choices(categories, k=10),
    'ê°€ê²©': [random.randint(5000, 30000) for _ in range(10)],
    'ë¸Œëœë“œ': random.choices(['ë¡œì–„ìºë‹Œ', 'í“¨ë¦¬ë‚˜', 'ë‚´ì¶”ëŸ´ì½”ì–´', 'ìœ„ìŠ¤ì¹´ìŠ¤'], k=10),
    'ì¬ê³ ìˆ˜ëŸ‰': [random.randint(10, 100) for _ in range(10)],
    'ë“±ë¡ì¼ì': [datetime(2025, random.randint(1, 6), random.randint(1, 28)) for _ in range(10)],
    'ì¸ê¸°ì§€ìˆ˜': [round(random.uniform(60, 100), 1) for _ in range(10)],
    'ê´€ë ¨ ì§ˆë³‘ ì¶”ì²œ': random.choices(['ì—†ìŒ', 'ìš”ë¡œê²°ì„', 'ë¹„ì—¼', 'ì¹˜ì£¼ì§ˆí™˜'], k=10),
    'ì—°ë ¹ëŒ€ ì¶”ì²œ': random.choices(['ì „ì—°ë ¹', '12ê°œì›” ë¯¸ë§Œ', '12ê°œì›” ì´ìƒ'], k=10),
    'is_best': random.choices([True, False], k=10),
    'is_recommended': random.choices([True, False], k=10),
    'recommendation_score': [round(random.uniform(60, 100), 1) for _ in range(10)]
})

```

```python
order_records = []
order_statuses = ['completed', 'cancelled', 'refunded']
payment_methods = ['ì¹´ë“œ', 'ê°„í¸ê²°ì œ', 'í¬ì¸íŠ¸', 'ë¬´í†µì¥']

for i in range(1, 31):
    cust = random.choice(customers['customer_id'])
    prod = random.choice(products['product_id'])
    qty = random.randint(1, 5)
    price = products.loc[products['product_id'] == prod, 'ê°€ê²©'].values[0]
    discount_used = random.choice([True, False])
    order_records.append({
        'order_id': f'ORD{str(i).zfill(3)}',
        'customer_id': cust,
        'product_id': prod,
        'ìˆ˜ëŸ‰': qty,
        'ì£¼ë¬¸ì¼ì': datetime(2025, random.randint(1, 6), random.randint(1, 28)),
        'ê²°ì œê¸ˆì•¡': int(price * qty * (0.9 if discount_used else 1.0)),
        'ê²°ì œìˆ˜ë‹¨': random.choice(payment_methods),
        'í• ì¸ì¿ í°ì‚¬ìš©ì—¬ë¶€': discount_used,
        'ë°°ì†¡ë°©ë²•': random.choice(['ë¡œì¼“ë°°ì†¡', 'ì¼ë°˜ë°°ì†¡']),
        'order_status': random.choices(order_statuses, weights=[0.7, 0.2, 0.1])[0]
    })

orders = pd.DataFrame(order_records)

```

```python
# ë°ì´í„° í™•ì¸
print("ğŸ“‹ ê³ ê°:")
display(customers.head())

print("ğŸ± ê³ ì–‘ì´:")
display(cats.head())

print("ğŸ›’ ìƒí’ˆ:")
display(products.head())

print("ğŸ“¦ ì£¼ë¬¸:")
display(orders.head())

```

ğŸ“‹ ê³ ê° 
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>customer_id</th>
      <th>name</th>
      <th>ê°€ì…ì¼</th>
      <th>ìƒë…„ì›”ì¼</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>CUST001</td>
      <td>ì§‘ì‚¬1</td>
      <td>2024-12-13</td>
      <td>2000-05-27</td>
    </tr>
    <tr>
      <th>1</th>
      <td>CUST002</td>
      <td>ì§‘ì‚¬2</td>
      <td>2024-06-18</td>
      <td>1995-06-28</td>
    </tr>
    <tr>
      <th>2</th>
      <td>CUST003</td>
      <td>ì§‘ì‚¬3</td>
      <td>2024-04-18</td>
      <td>1986-03-10</td>
    </tr>
    <tr>
      <th>3</th>
      <td>CUST004</td>
      <td>ì§‘ì‚¬4</td>
      <td>2024-11-07</td>
      <td>1988-09-08</td>
    </tr>
    <tr>
      <th>4</th>
      <td>CUST005</td>
      <td>ì§‘ì‚¬5</td>
      <td>2024-01-19</td>
      <td>1981-10-19</td>
    </tr>
  </tbody>
</table>

ğŸ± ê³ ì–‘ì´
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cat_id</th>
      <th>customer_id</th>
      <th>name</th>
      <th>ë‚˜ì´(ê°œì›”)</th>
      <th>ì„±ë³„</th>
      <th>í’ˆì¢…</th>
      <th>ì§€ë³‘ ì´ë ¥</th>
      <th>cat_birthday</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>CAT001</td>
      <td>CUST001</td>
      <td>ë‚˜ë¹„1</td>
      <td>88</td>
      <td>M</td>
      <td>ë¨¼ì¹˜í‚¨</td>
      <td>ì—†ìŒ</td>
      <td>2025-03-16</td>
    </tr>
    <tr>
      <th>1</th>
      <td>CAT002</td>
      <td>CUST002</td>
      <td>ë‚˜ë¹„2</td>
      <td>156</td>
      <td>F</td>
      <td>ëŸ¬ì‹œì•ˆë¸”ë£¨</td>
      <td>ìš”ë¡œê²°ì„</td>
      <td>2025-02-26</td>
    </tr>
    <tr>
      <th>2</th>
      <td>CAT003</td>
      <td>CUST003</td>
      <td>ë‚˜ë¹„3</td>
      <td>43</td>
      <td>M</td>
      <td>ë¨¼ì¹˜í‚¨</td>
      <td>ë¹„ì—¼</td>
      <td>2025-08-04</td>
    </tr>
    <tr>
      <th>3</th>
      <td>CAT004</td>
      <td>CUST003</td>
      <td>ë‚˜ë¹„4</td>
      <td>129</td>
      <td>M</td>
      <td>ìŠ¤í•‘í¬ìŠ¤</td>
      <td>ìš”ë¡œê²°ì„</td>
      <td>2025-11-20</td>
    </tr>
    <tr>
      <th>4</th>
      <td>CAT005</td>
      <td>CUST004</td>
      <td>ë‚˜ë¹„5</td>
      <td>121</td>
      <td>M</td>
      <td>ë¨¼ì¹˜í‚¨</td>
      <td>ë¹„ì—¼</td>
      <td>2025-02-24</td>
    </tr>
  </tbody>
</table>

ğŸ›’ ìƒí’ˆ
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>product_id</th>
      <th>name</th>
      <th>ì¹´í…Œê³ ë¦¬</th>
      <th>ê°€ê²©</th>
      <th>ë¸Œëœë“œ</th>
      <th>ì¬ê³ ìˆ˜ëŸ‰</th>
      <th>ë“±ë¡ì¼ì</th>
      <th>ì¸ê¸°ì§€ìˆ˜</th>
      <th>ê´€ë ¨ ì§ˆë³‘ ì¶”ì²œ</th>
      <th>ì—°ë ¹ëŒ€ ì¶”ì²œ</th>
      <th>is_best</th>
      <th>is_recommended</th>
      <th>recommendation_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>PROD001</td>
      <td>ìƒí’ˆ1</td>
      <td>ê±´ê°•</td>
      <td>10322</td>
      <td>ìœ„ìŠ¤ì¹´ìŠ¤</td>
      <td>75</td>
      <td>2025-04-23</td>
      <td>66.3</td>
      <td>ì¹˜ì£¼ì§ˆí™˜</td>
      <td>12ê°œì›” ë¯¸ë§Œ</td>
      <td>True</td>
      <td>True</td>
      <td>90.4</td>
    </tr>
    <tr>
      <th>1</th>
      <td>PROD002</td>
      <td>ìƒí’ˆ2</td>
      <td>ì¥ë‚œê°</td>
      <td>11770</td>
      <td>ìœ„ìŠ¤ì¹´ìŠ¤</td>
      <td>54</td>
      <td>2025-02-13</td>
      <td>97.9</td>
      <td>ë¹„ì—¼</td>
      <td>ì „ì—°ë ¹</td>
      <td>True</td>
      <td>True</td>
      <td>65.1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>PROD003</td>
      <td>ìƒí’ˆ3</td>
      <td>ê°„ì‹</td>
      <td>28499</td>
      <td>í“¨ë¦¬ë‚˜</td>
      <td>24</td>
      <td>2025-06-25</td>
      <td>65.8</td>
      <td>ë¹„ì—¼</td>
      <td>ì „ì—°ë ¹</td>
      <td>True</td>
      <td>False</td>
      <td>83.3</td>
    </tr>
    <tr>
      <th>3</th>
      <td>PROD004</td>
      <td>ìƒí’ˆ4</td>
      <td>ìƒí™œìš©í’ˆ</td>
      <td>21177</td>
      <td>ë‚´ì¶”ëŸ´ì½”ì–´</td>
      <td>39</td>
      <td>2025-03-07</td>
      <td>72.5</td>
      <td>ìš”ë¡œê²°ì„</td>
      <td>12ê°œì›” ë¯¸ë§Œ</td>
      <td>True</td>
      <td>True</td>
      <td>84.4</td>
    </tr>
    <tr>
      <th>4</th>
      <td>PROD005</td>
      <td>ìƒí’ˆ5</td>
      <td>ê°„ì‹</td>
      <td>16956</td>
      <td>ë‚´ì¶”ëŸ´ì½”ì–´</td>
      <td>17</td>
      <td>2025-02-09</td>
      <td>65.3</td>
      <td>ì¹˜ì£¼ì§ˆí™˜</td>
      <td>ì „ì—°ë ¹</td>
      <td>True</td>
      <td>True</td>
      <td>87.3</td>
    </tr>
  </tbody>
</table>

ğŸ“¦ ì£¼ë¬¸:
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>order_id</th>
      <th>customer_id</th>
      <th>product_id</th>
      <th>ìˆ˜ëŸ‰</th>
      <th>ì£¼ë¬¸ì¼ì</th>
      <th>ê²°ì œê¸ˆì•¡</th>
      <th>ê²°ì œìˆ˜ë‹¨</th>
      <th>í• ì¸ì¿ í°ì‚¬ìš©ì—¬ë¶€</th>
      <th>ë°°ì†¡ë°©ë²•</th>
      <th>order_status</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>ORD001</td>
      <td>CUST005</td>
      <td>PROD010</td>
      <td>3</td>
      <td>2025-05-28</td>
      <td>80232</td>
      <td>í¬ì¸íŠ¸</td>
      <td>False</td>
      <td>ì¼ë°˜ë°°ì†¡</td>
      <td>completed</td>
    </tr>
    <tr>
      <th>1</th>
      <td>ORD002</td>
      <td>CUST006</td>
      <td>PROD001</td>
      <td>5</td>
      <td>2025-05-18</td>
      <td>46449</td>
      <td>ê°„í¸ê²°ì œ</td>
      <td>True</td>
      <td>ì¼ë°˜ë°°ì†¡</td>
      <td>completed</td>
    </tr>
    <tr>
      <th>2</th>
      <td>ORD003</td>
      <td>CUST003</td>
      <td>PROD007</td>
      <td>1</td>
      <td>2025-05-06</td>
      <td>27051</td>
      <td>í¬ì¸íŠ¸</td>
      <td>False</td>
      <td>ë¡œì¼“ë°°ì†¡</td>
      <td>completed</td>
    </tr>
    <tr>
      <th>3</th>
      <td>ORD004</td>
      <td>CUST009</td>
      <td>PROD003</td>
      <td>2</td>
      <td>2025-06-11</td>
      <td>56998</td>
      <td>ë¬´í†µì¥</td>
      <td>False</td>
      <td>ë¡œì¼“ë°°ì†¡</td>
      <td>completed</td>
    </tr>
    <tr>
      <th>4</th>
      <td>ORD005</td>
      <td>CUST001</td>
      <td>PROD004</td>
      <td>4</td>
      <td>2025-01-06</td>
      <td>76237</td>
      <td>ë¬´í†µì¥</td>
      <td>True</td>
      <td>ì¼ë°˜ë°°ì†¡</td>
      <td>completed</td>
    </tr>
  </tbody>
</table>
</div>

```python
# ì£¼ë¬¸ í…Œì´ë¸”ê³¼ ìƒí’ˆ í…Œì´ë¸”ì„ product_id ê¸°ì¤€ìœ¼ë¡œ ê²°í•©
order_products = pd.merge(orders, products, on='product_id')

# ì¹´í…Œê³ ë¦¬ë³„ ì´ ë§¤ì¶œ ê³„ì‚°
category_sales = order_products.groupby('ì¹´í…Œê³ ë¦¬')['ê²°ì œê¸ˆì•¡'].sum().reset_index()

# ë§¤ì¶œ ë†’ì€ ìˆœìœ¼ë¡œ ì •ë ¬
category_sales = category_sales.sort_values(by='ê²°ì œê¸ˆì•¡', ascending=False)

# ê²°ê³¼ ë³´ê¸°
print("ğŸ’¸ ì¹´í…Œê³ ë¦¬ë³„ ì´ ë§¤ì¶œ:")
display(category_sales)
```
ğŸ’¸ ì¹´í…Œê³ ë¦¬ë³„ ì´ ë§¤ì¶œ:

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ì¹´í…Œê³ ë¦¬</th>
      <th>ê²°ì œê¸ˆì•¡</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2</th>
      <td>ìƒí™œìš©í’ˆ</td>
      <td>546371</td>
    </tr>
    <tr>
      <th>3</th>
      <td>ì¥ë‚œê°</td>
      <td>497189</td>
    </tr>
    <tr>
      <th>0</th>
      <td>ê°„ì‹</td>
      <td>276034</td>
    </tr>
    <tr>
      <th>1</th>
      <td>ê±´ê°•</td>
      <td>180633</td>
    </tr>
  </tbody>
</table>
</div>

```python
# ì—°ë ¹ëŒ€ ì»¬ëŸ¼ ì¶”ê°€ (ê³ ì–‘ì´ ë‚˜ì´ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ê·¸ë£¹í•‘)
cats['ì—°ë ¹ëŒ€'] = pd.cut(
    cats['ë‚˜ì´(ê°œì›”)'],
    bins=[0, 12, 60, 240],
    labels=['12ê°œì›” ë¯¸ë§Œ', '1~5ì„¸', '5ì„¸ ì´ìƒ']
)

# cats + customers + orders + products join
merged = pd.merge(orders, customers, on='customer_id')
merged = pd.merge(merged, products[['product_id', 'ì¹´í…Œê³ ë¦¬']], on='product_id')
merged = pd.merge(merged, cats[['customer_id', 'cat_id', 'ì—°ë ¹ëŒ€']], on='customer_id')

# ì—°ë ¹ëŒ€ë³„ ì¹´í…Œê³ ë¦¬ë³„ ë§¤ì¶œ ì´í•©
age_cat_sales = merged.groupby(['ì—°ë ¹ëŒ€', 'ì¹´í…Œê³ ë¦¬'])['ê²°ì œê¸ˆì•¡'].sum().reset_index()

# ê²°ê³¼ í™•ì¸
print("ğŸ± ê³ ì–‘ì´ ì—°ë ¹ëŒ€ë³„ ì¹´í…Œê³ ë¦¬ ë§¤ì¶œ:")
display(age_cat_sales)

```

ğŸ± ê³ ì–‘ì´ ì—°ë ¹ëŒ€ë³„ ì¹´í…Œê³ ë¦¬ ë§¤ì¶œ:
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ì—°ë ¹ëŒ€</th>
      <th>ì¹´í…Œê³ ë¦¬</th>
      <th>ê²°ì œê¸ˆì•¡</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>12ê°œì›” ë¯¸ë§Œ</td>
      <td>ê°„ì‹</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>12ê°œì›” ë¯¸ë§Œ</td>
      <td>ê±´ê°•</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>12ê°œì›” ë¯¸ë§Œ</td>
      <td>ìƒí™œìš©í’ˆ</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>12ê°œì›” ë¯¸ë§Œ</td>
      <td>ì¥ë‚œê°</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1~5ì„¸</td>
      <td>ê°„ì‹</td>
      <td>15260</td>
    </tr>
    <tr>
      <th>5</th>
      <td>1~5ì„¸</td>
      <td>ê±´ê°•</td>
      <td>59867</td>
    </tr>
    <tr>
      <th>6</th>
      <td>1~5ì„¸</td>
      <td>ìƒí™œìš©í’ˆ</td>
      <td>257273</td>
    </tr>
    <tr>
      <th>7</th>
      <td>1~5ì„¸</td>
      <td>ì¥ë‚œê°</td>
      <td>365445</td>
    </tr>
    <tr>
      <th>8</th>
      <td>5ì„¸ ì´ìƒ</td>
      <td>ê°„ì‹</td>
      <td>276034</td>
    </tr>
    <tr>
      <th>9</th>
      <td>5ì„¸ ì´ìƒ</td>
      <td>ê±´ê°•</td>
      <td>180633</td>
    </tr>
    <tr>
      <th>10</th>
      <td>5ì„¸ ì´ìƒ</td>
      <td>ìƒí™œìš©í’ˆ</td>
      <td>519627</td>
    </tr>
    <tr>
      <th>11</th>
      <td>5ì„¸ ì´ìƒ</td>
      <td>ì¥ë‚œê°</td>
      <td>237500</td>
    </tr>
  </tbody>
</table>

```python
import matplotlib.pyplot as plt
plt.rc('font', family='NanumBarunGothic')
plt.rcParams['axes.unicode_minus'] =False
```

```python
import matplotlib.pyplot as plt
import seaborn as sns

plt.figure(figsize=(10,6))
sns.barplot(data=age_cat_sales, x='ì—°ë ¹ëŒ€', y='ê²°ì œê¸ˆì•¡', hue='ì¹´í…Œê³ ë¦¬')
plt.title('ê³ ì–‘ì´ ì—°ë ¹ëŒ€ë³„ ì¹´í…Œê³ ë¦¬ ë§¤ì¶œ')
plt.ylabel('ì´ ê²°ì œ ê¸ˆì•¡')
plt.xlabel('ê³ ì–‘ì´ ì—°ë ¹ëŒ€')
plt.xticks(rotation=0)
plt.legend(title='ì¹´í…Œê³ ë¦¬')
plt.show()
```
![ê³ ì–‘ì´ ì—°ë ¹ëŒ€ë³„ ì¹´í…Œê³ ë¦¬ ë§¤ì¶œ](assets/img/cat_age_sales.png)

```python
# í• ì¸ì¿ í° ì‚¬ìš© ì—¬ë¶€ì— ë”°ë¥¸ í‰ê·  ê²°ì œ ê¸ˆì•¡ ë¹„êµ
coupon_effect = orders.groupby('í• ì¸ì¿ í°ì‚¬ìš©ì—¬ë¶€')['ê²°ì œê¸ˆì•¡'].mean().reset_index()
print("ğŸŸï¸ í• ì¸ ì¿ í° ì‚¬ìš© ì—¬ë¶€ë³„ í‰ê·  ê²°ì œê¸ˆì•¡:")
display(coupon_effect)
```

 ğŸŸï¸ í• ì¸ ì¿ í° ì‚¬ìš© ì—¬ë¶€ë³„ í‰ê·  ê²°ì œê¸ˆì•¡:
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>í• ì¸ì¿ í°ì‚¬ìš©ì—¬ë¶€</th>
      <th>ê²°ì œê¸ˆì•¡</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>False</td>
      <td>51597.9375</td>
    </tr>
    <tr>
      <th>1</th>
      <td>True</td>
      <td>48190.0000</td>
    </tr>
  </tbody>
</table>

```python
import seaborn as sns
import matplotlib.pyplot as plt

plt.figure(figsize=(6,4))
sns.barplot(data=coupon_effect, x='í• ì¸ì¿ í°ì‚¬ìš©ì—¬ë¶€', y='ê²°ì œê¸ˆì•¡')
plt.title('ì¿ í° ì‚¬ìš© ìœ ë¬´ì— ë”°ë¥¸ í‰ê·  ê²°ì œê¸ˆì•¡ ë¹„êµ')
plt.ylabel('í‰ê·  ê²°ì œê¸ˆì•¡')
plt.xlabel('ì¿ í° ì‚¬ìš© ì—¬ë¶€')
plt.show()
```


    
![ì¿ í° ì‚¬ìš© ìœ ë¬´ì— ë”°ë¥¸ í‰ê·  ê²°ì œê¸ˆì•¡](assets/img/coupon_usage_avg_payment.png)
    


```python
# 'cancelled' or 'refunded'ì¸ ì£¼ë¬¸ë§Œ í•„í„°ë§
cancelled_or_refunded = orders[orders['order_status'].isin(['cancelled', 'refunded'])]

# ìƒí’ˆë³„ ì´íƒˆ ê±´ìˆ˜ ì§‘ê³„
problem_products = cancelled_or_refunded.groupby('product_id').size().reset_index(name='ì´íƒˆê±´ìˆ˜')

# ìƒìœ„ 5ê°œ ì¶”ì¶œ
top5_problem_products = problem_products.sort_values(by='ì´íƒˆê±´ìˆ˜', ascending=False).head(5)

# ìƒí’ˆëª… ë¶™ì´ê¸°
top5_problem_products = pd.merge(top5_problem_products, products[['product_id', 'name', 'ì¹´í…Œê³ ë¦¬']], on='product_id')

# ê²°ê³¼ ì¶œë ¥
print("ğŸš¨ í™˜ë¶ˆ/ì·¨ì†Œê°€ ë§ì´ ë°œìƒí•œ ìƒí’ˆ TOP 5:")
display(top5_problem_products)
```

ğŸš¨ í™˜ë¶ˆ/ì·¨ì†Œê°€ ë§ì´ ë°œìƒí•œ ìƒí’ˆ TOP 5:
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>product_id</th>
      <th>ì´íƒˆê±´ìˆ˜</th>
      <th>name</th>
      <th>ì¹´í…Œê³ ë¦¬</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>PROD002</td>
      <td>2</td>
      <td>ìƒí’ˆ2</td>
      <td>ì¥ë‚œê°</td>
    </tr>
    <tr>
      <th>1</th>
      <td>PROD007</td>
      <td>2</td>
      <td>ìƒí’ˆ7</td>
      <td>ì¥ë‚œê°</td>
    </tr>
    <tr>
      <th>2</th>
      <td>PROD001</td>
      <td>1</td>
      <td>ìƒí’ˆ1</td>
      <td>ê±´ê°•</td>
    </tr>
    <tr>
      <th>3</th>
      <td>PROD005</td>
      <td>1</td>
      <td>ìƒí’ˆ5</td>
      <td>ê°„ì‹</td>
    </tr>
    <tr>
      <th>4</th>
      <td>PROD010</td>
      <td>1</td>
      <td>ìƒí’ˆ10</td>
      <td>ìƒí™œìš©í’ˆ</td>
    </tr>
  </tbody>
</table>

```python
from datetime import timedelta

# ì£¼ë¬¸ + ê³ ì–‘ì´ ì •ë³´ ì¡°ì¸
orders_with_cats = pd.merge(orders, cats[['customer_id', 'cat_birthday']], on='customer_id')

# ìƒì¼ ê¸°ì¤€ Â±7ì¼ ì´ë‚´ ì—¬ë¶€ íŒë‹¨
orders_with_cats['ìƒì¼ì£¼ê°„ì—¬ë¶€'] = orders_with_cats.apply(
    lambda row: abs((row['ì£¼ë¬¸ì¼ì'] - row['cat_birthday']).days) <= 7,
    axis=1
)

# ìƒì¼ì£¼ê°„ ì—¬ë¶€ë³„ í‰ê·  ê²°ì œ ê¸ˆì•¡ ë¹„êµ
birthday_effect = orders_with_cats.groupby('ìƒì¼ì£¼ê°„ì—¬ë¶€')['ê²°ì œê¸ˆì•¡'].mean().reset_index()

print("ğŸ‚ ìƒì¼ì£¼ê°„ vs ì¼ë°˜ê¸°ê°„ í‰ê·  ê²°ì œê¸ˆì•¡ ë¹„êµ:")
display(birthday_effect)
```

ğŸ‚ ìƒì¼ì£¼ê°„ vs ì¼ë°˜ê¸°ê°„ í‰ê·  ê²°ì œê¸ˆì•¡ ë¹„êµ:
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ìƒì¼ì£¼ê°„ì—¬ë¶€</th>
      <th>ê²°ì œê¸ˆì•¡</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>False</td>
      <td>48540.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>True</td>
      <td>18579.0</td>
    </tr>
  </tbody>
</table>

```python
sns.barplot(data=birthday_effect, x='ìƒì¼ì£¼ê°„ì—¬ë¶€', y='ê²°ì œê¸ˆì•¡')
plt.title('ê³ ì–‘ì´ ìƒì¼ì£¼ê°„ vs ì¼ë°˜ê¸°ê°„ í‰ê·  ê²°ì œê¸ˆì•¡')
plt.ylabel('í‰ê·  ê²°ì œê¸ˆì•¡')
plt.xlabel('ìƒì¼ì£¼ê°„ ì—¬ë¶€')
plt.show()
```

![ê³ ì–‘ì´ ìƒì¼ì£¼ê°„ vs ì¼ë°˜ê¸°ê°„ í‰ê·  ê²°ì œê¸ˆì•¡](assets/img/birthday_week_vs_normal_payment.png)
    

```python
from scipy.stats import ttest_ind

# ìƒì¼ì£¼ê°„ True/False ê·¸ë£¹ìœ¼ë¡œ ë‚˜ëˆ„ê¸°
group_true = orders_with_cats[orders_with_cats['ìƒì¼ì£¼ê°„ì—¬ë¶€'] == True]['ê²°ì œê¸ˆì•¡']
group_false = orders_with_cats[orders_with_cats['ìƒì¼ì£¼ê°„ì—¬ë¶€'] == False]['ê²°ì œê¸ˆì•¡']

# ë…ë¦½í‘œë³¸ t-test ì‹¤í–‰
t_stat, p_value = ttest_ind(group_true, group_false, equal_var=False)

print(f"ğŸ“Š t-statistic: {t_stat:.3f}")
print(f"ğŸ“‰ p-value: {p_value:.4f}")
```

    ğŸ“Š t-statistic: nan
    ğŸ“‰ p-value: nan


```python
import numpy as np
import pandas as pd

# ìƒ˜í”Œ ìˆ˜
n = 100

# A ê·¸ë£¹: ê³ ì • ê¸ˆì•¡ ì¿ í°
group_A = pd.DataFrame({
    'user_id': [f'A{i:03d}' for i in range(n)],
    'group': 'A',
    'ê²°ì œê¸ˆì•¡': np.random.normal(loc=55000, scale=8000, size=n).astype(int)
})

# B ê·¸ë£¹: í¼ì„¼íŠ¸ í• ì¸ ì¿ í°
group_B = pd.DataFrame({
    'user_id': [f'B{i:03d}' for i in range(n)],
    'group': 'B',
    'ê²°ì œê¸ˆì•¡': np.random.normal(loc=59000, scale=9000, size=n).astype(int)
})

# í•©ì¹˜ê¸°
ab_test = pd.concat([group_A, group_B])
```

```python
import seaborn as sns
import matplotlib.pyplot as plt

sns.barplot(data=ab_test, x='group', y='ê²°ì œê¸ˆì•¡', ci='sd')
plt.title('ì¿ í° íƒ€ì…ë³„ í‰ê·  ê²°ì œê¸ˆì•¡')
plt.show()
```

![ì¿ í° íƒ€ì…ë³„ í‰ê·  ê²°ì œê¸ˆì•¡](assets/img/coupon_type_avg_payment.png)

```python
from scipy.stats import ttest_ind

# ê·¸ë£¹ ë¶„ë¦¬
a_vals = ab_test[ab_test['group'] == 'A']['ê²°ì œê¸ˆì•¡']
b_vals = ab_test[ab_test['group'] == 'B']['ê²°ì œê¸ˆì•¡']

# t-test
t_stat, p_value = ttest_ind(a_vals, b_vals, equal_var=False)

print(f"ğŸ“Š t-statistic: {t_stat:.3f}")
print(f"ğŸ“‰ p-value: {p_value:.4f}")
```

    ğŸ“Š t-statistic: -2.888
    ğŸ“‰ p-value: 0.0043


